<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Overlay Web App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            padding: 40px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            color: #667eea;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        /* Page containers */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .lang-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .lang-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: #667eea;
            color: white;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-label {
            display: block;
            padding: 15px;
            background: white;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        input[type="file"] {
            display: none;
        }

        .file-name {
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        input[type="number"],
        input[type="text"],
        select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="color"] {
            width: 100%;
            height: 45px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .checkbox-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .process-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-container {
            display: none;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .status-text {
            margin-top: 10px;
            text-align: center;
            color: #666;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .preview-item {
            position: relative;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .preview-item .download-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 8px 15px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        /* Contact Page Styles */
        .contact-content {
            padding: 20px;
        }

        .contact-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .contact-info:hover {
            transform: translateX(5px);
        }

        .contact-icon {
            font-size: 2em;
            min-width: 50px;
        }

        .contact-text h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .contact-text p {
            color: #666;
            font-size: 0.95em;
        }

        .contact-text a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .contact-text a:hover {
            text-decoration: underline;
        }

        /* About Page Styles */
        .about-content {
            padding: 20px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .info-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .info-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .info-section p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .credits {
            text-align: center;
            margin-top: 30px;
            color: #888;
            font-size: 0.85em;
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mainTitle">Image Overlay</h1>
        <p class="subtitle" id="subtitle">Add watermarks to your images with ease</p>

        <div class="lang-selection">
            <button class="lang-btn active" onclick="setLanguage('en')">English</button>
            <button class="lang-btn" onclick="setLanguage('pt')">Português</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('editor')" id="navEditor">Editor</button>
            <button class="nav-tab" onclick="showPage('about')" id="navAbout">About</button>
            <button class="nav-tab" onclick="showPage('contact')" id="navContact">Contact</button>
        </div>

        <!-- Editor Page -->
        <div id="editorPage" class="page active">
            <div class="section">
                <h3 id="overlayTitle">Select Overlay Image</h3>
                <div class="file-input-wrapper">
                    <label for="overlayInput" class="file-input-label">
                        <span id="overlayLabel">📷 Click to select overlay image (PNG with transparency)</span>
                    </label>
                    <input type="file" id="overlayInput" accept="image/*">
                    <div class="file-name" id="overlayFileName"></div>
                </div>
            </div>

            <div class="section">
                <h3 id="targetTitle">Select Target Images</h3>
                <div class="file-input-wrapper">
                    <label for="targetInput" class="file-input-label">
                        <span id="targetLabel">🖼️ Click to select images to watermark (multiple)</span>
                    </label>
                    <input type="file" id="targetInput" accept="image/*" multiple>
                    <div class="file-name" id="targetFileName"></div>
                </div>
            </div>

            <div class="section">
                <h3 id="optionsTitle">Watermark Options</h3>
                
                <div class="options-grid">
                    <div class="option-group">
                        <label for="position" id="positionLabel">Position</label>
                        <select id="position">
                            <option value="bottom_right">Bottom Right</option>
                            <option value="bottom_left">Bottom Left</option>
                            <option value="top_right">Top Right</option>
                            <option value="top_left">Top Left</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="height" id="heightLabel">Height (px or %)</label>
                        <input type="text" id="height" placeholder="e.g., 50 or 10%">
                    </div>

                    <div class="option-group">
                        <label for="opacity" id="opacityLabel">Opacity (0-100%)</label>
                        <input type="number" id="opacity" min="0" max="100" value="100">
                    </div>
                </div>

                <div class="checkbox-row">
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoAdjust">
                        <label for="autoAdjust" id="autoAdjustLabel">Auto-adjust contrast based on background</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="enableRecolor">
                        <label for="enableRecolor" id="recolorLabel">Enable color change</label>
                    </div>
                </div>

                <div class="option-group" id="colorPickerGroup" style="display: none; margin-top: 15px;">
                    <label for="color" id="colorLabel">Recolor (optional)</label>
                    <input type="color" id="color" value="#000000">
                </div>
            </div>

            <button class="process-btn" id="processBtn" onclick="processImages()">
                <span id="processBtnText">Process Images</span>
            </button>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="status-text" id="statusText"></div>
            </div>

            <div class="preview-grid" id="previewGrid"></div>
        </div>

        <!-- About Page -->
        <div id="aboutPage" class="page">
            <div class="about-content">
                <div class="info-section">
                    <h2 id="aboutTitle">About Image Overlay</h2>
                    <p id="aboutText1">Image Overlay is a powerful web-based tool designed to help you add watermarks to your images quickly and efficiently. Whether you're a photographer, designer, or content creator, this tool makes it easy to protect your work and brand your images.</p>
                    <p id="aboutText2">This application runs entirely in your browser, meaning your images never leave your computer. All processing is done locally, ensuring your privacy and security.</p>
                </div>

                <h2 style="text-align: center; color: #333; margin: 30px 0 20px;" id="featuresTitle">Features</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">🎨</div>
                        <h3 id="feature1Title">Custom Colors</h3>
                        <p id="feature1Text">Change watermark colors to match your brand or contrast with your images</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">📐</div>
                        <h3 id="feature2Title">Flexible Sizing</h3>
                        <p id="feature2Text">Adjust watermark size using pixels or percentages for perfect proportions</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🎭</div>
                        <h3 id="feature3Title">Opacity Control</h3>
                        <p id="feature3Text">Fine-tune transparency levels from subtle to prominent</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🤖</div>
                        <h3 id="feature4Title">Auto-Adjust</h3>
                        <p id="feature4Text">Automatically adjust watermark contrast based on background brightness</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">📍</div>
                        <h3 id="feature5Title">Position Control</h3>
                        <p id="feature5Text">Place watermarks in any corner of your images</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">⚡</div>
                        <h3 id="feature6Title">Batch Processing</h3>
                        <p id="feature6Text">Process multiple images at once to save time</p>
                    </div>
                </div>

                <div class="info-section" style="margin-top: 30px;">
                    <h2 id="howToTitle">How to Use</h2>
                    <p id="howToText1"><strong>1. Select Overlay:</strong> Choose your watermark image (preferably PNG with transparency)</p>
                    <p id="howToText2"><strong>2. Select Images:</strong> Pick one or multiple images you want to watermark</p>
                    <p id="howToText3"><strong>3. Customize:</strong> Adjust position, size, opacity, and colors as needed</p>
                    <p id="howToText4"><strong>4. Process:</strong> Click the process button and download your watermarked images</p>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contactPage" class="page">
            <div class="contact-content">
                <div class="contact-card">
                    <h2 style="text-align: center; color: #333; margin-bottom: 25px;" id="contactTitle">Get in Touch</h2>
                    
                    <div class="contact-info">
                        <div class="contact-icon">👨‍💻</div>
                        <div class="contact-text">
                            <h3 id="devTitle">Developer</h3>
                            <p>Emmanoel</p>
                        </div>
                    </div>

                    <div class="contact-info">
                        <div class="contact-icon">🐙</div>
                        <div class="contact-text">
                            <h3>GitHub</h3>
                            <p><a href="https://github.com/Ium101" target="_blank">github.com/Ium101</a></p>
                        </div>
                    </div>

                    <div class="contact-info">
                        <div class="contact-icon">💬</div>
                        <div class="contact-text">
                            <h3 id="feedbackTitle">Feedback & Support</h3>
                            <p id="feedbackText">Found a bug or have a feature request? Open an issue on <a href="https://github.com/Ium101/Image-Overlay-Z" target="_blank">GitHub!</a></p>
                        </div>
                    </div>

                    <div class="contact-info">
                        <div class="contact-icon">⭐</div>
                        <div class="contact-text">
                            <h3 id="contributeTitle">Contribute</h3>
                            <p id="contributeText">This is an open-source project. Contributions are welcome!</p>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h2 id="licenseTitle">License & Credits</h2>
                    <p id="licenseText">This tool was created by Ium101 and is available for free use. Built with vanilla JavaScript, HTML5 Canvas API, and lots of ❤️.</p>
                </div>
            </div>
        </div>

        <div class="credits">
            <p>Made by Ium101 from GitHub</p>
            <p>Feito por Ium101 do GitHub</p>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                mainTitle: "Image Overlay",
                subtitle: "Add watermarks to your images with ease",
                navEditor: "Editor",
                navAbout: "About",
                navContact: "Contact",
                overlayTitle: "Select Overlay Image",
                overlayLabel: "📷 Click to select overlay image (PNG with transparency)",
                targetTitle: "Select Target Images",
                targetLabel: "🖼️ Click to select images to watermark (multiple)",
                optionsTitle: "Watermark Options",
                positionLabel: "Position",
                heightLabel: "Height (px or %)",
                opacityLabel: "Opacity (0-100%)",
                colorLabel: "Recolor (optional)",
                recolorLabel: "Enable color change",
                autoAdjustLabel: "Auto-adjust contrast based on background",
                processBtnText: "Process Images",
                processing: "Processing: ",
                done: "Done! Click images to download",
                error: "Error: ",
                aboutTitle: "About Image Overlay",
                aboutText1: "Image Overlay is a powerful web-based tool designed to help you add watermarks to your images quickly and efficiently. Whether you're a photographer, designer, or content creator, this tool makes it easy to protect your work and brand your images.",
                aboutText2: "This application runs entirely in your browser, meaning your images never leave your computer. All processing is done locally, ensuring your privacy and security.",
                featuresTitle: "Features",
                feature1Title: "Custom Colors",
                feature1Text: "Change watermark colors to match your brand or contrast with your images",
                feature2Title: "Flexible Sizing",
                feature2Text: "Adjust watermark size using pixels or percentages for perfect proportions",
                feature3Title: "Opacity Control",
                feature3Text: "Fine-tune transparency levels from subtle to prominent",
                feature4Title: "Auto-Adjust",
                feature4Text: "Automatically adjust watermark contrast based on background brightness",
                feature5Title: "Position Control",
                feature5Text: "Place watermarks in any corner of your images",
                feature6Title: "Batch Processing",
                feature6Text: "Process multiple images at once to save time",
                howToTitle: "How to Use",
                howToText1: "1. Select Overlay: Choose your watermark image (preferably PNG with transparency)",
                howToText2: "2. Select Images: Pick one or multiple images you want to watermark",
                howToText3: "3. Customize: Adjust position, size, opacity, and colors as needed",
                howToText4: "4. Process: Click the process button and download your watermarked images",
                contactTitle: "Get in Touch",
                devTitle: "Developer",
                feedbackTitle: "Feedback & Support",
                feedbackText: "Found a bug or have a feature request? Open an issue on GitHub!",
                contributeTitle: "Contribute",
                contributeText: "This is an open-source project. Contributions are welcome!",
                licenseTitle: "License & Credits",
                licenseText: "This tool was created by Ium101 and is available for free use. Built with vanilla JavaScript, HTML5 Canvas API, and lots of ❤️."
            },
            pt: {
                mainTitle: "Sobreposição de Imagem",
                subtitle: "Adicione marcas d'água às suas imagens com facilidade",
                navEditor: "Editor",
                navAbout: "Sobre",
                navContact: "Contato",
                overlayTitle: "Selecionar Imagem de Sobreposição",
                overlayLabel: "📷 Clique para selecionar imagem de sobreposição (PNG com transparência)",
                targetTitle: "Selecionar Imagens Alvo",
                targetLabel: "🖼️ Clique para selecionar imagens para marcar (múltiplas)",
                optionsTitle: "Opções da Marca d'Água",
                positionLabel: "Posição",
                heightLabel: "Altura (px ou %)",
                opacityLabel: "Opacidade (0-100%)",
                colorLabel: "Recolorir (opcional)",
                recolorLabel: "Ativar mudança de cor",
                autoAdjustLabel: "Ajustar contraste automaticamente baseado no fundo",
                processBtnText: "Processar Imagens",
                processing: "Processando: ",
                done: "Concluído! Clique nas imagens para baixar",
                error: "Erro: ",
                aboutTitle: "Sobre o Image Overlay",
                aboutText1: "Image Overlay é uma ferramenta web poderosa projetada para ajudá-lo(a) a adicionar marcas d'água às suas imagens de forma rápida e eficiente. Seja você fotógrafo, designer ou criador de conteúdo, esta ferramenta facilita proteger seu trabalho e marcar suas imagens.",
                aboutText2: "Esta aplicação funciona inteiramente no seu navegador, o que significa que suas imagens nunca saem do seu computador. Todo o processamento é feito localmente, garantindo sua privacidade e segurança.",
                featuresTitle: "Recursos",
                feature1Title: "Cores Personalizadas",
                feature1Text: "Altere as cores da marca d'água para combinar com sua marca ou contrastar com suas imagens",
                feature2Title: "Tamanho Flexível",
                feature2Text: "Ajuste o tamanho da marca d'água usando pixels ou porcentagens para proporções perfeitas",
                feature3Title: "Controle de Opacidade",
                feature3Text: "Ajuste os níveis de transparência de sutil a proeminente",
                feature4Title: "Ajuste Automático",
                feature4Text: "Ajusta automaticamente o contraste da marca d'água com base no brilho do fundo",
                feature5Title: "Controle de Posição",
                feature5Text: "Posicione marcas d'água em qualquer canto de suas imagens",
                feature6Title: "Processamento em Lote",
                feature6Text: "Processe várias imagens de uma vez para economizar tempo",
                howToTitle: "Como Usar",
                howToText1: "1. Selecionar Sobreposição: Escolha sua imagem de marca d'água (preferencialmente PNG com transparência)",
                howToText2: "2. Selecionar Imagens: Escolha uma ou várias imagens que deseja marcar",
                howToText3: "3. Personalizar: Ajuste posição, tamanho, opacidade e cores conforme necessário",
                howToText4: "4. Processar: Clique no botão processar e baixe suas imagens marcadas",
                contactTitle: "Entre em Contato",
                devTitle: "Desenvolvedor",
                feedbackTitle: "Feedback & Suporte",
                feedbackText: "Encontrou um bug ou tem uma sugestão de recurso? Abra um issue no GitHub!",
                contributeTitle: "Contribuir",
                contributeText: "Este é um projeto de código aberto. Contribuições são bem-vindas!",
                licenseTitle: "Licença & Créditos",
                licenseText: "Esta ferramenta foi criada por Ium101 e está disponível para uso gratuito. Construída com JavaScript vanilla, HTML5 Canvas API e muito ❤️."
            }
        };

        let currentLang = 'en';
        let overlayImage = null;
        let targetImages = [];

        // Toggle color picker visibility
        document.getElementById('enableRecolor').addEventListener('change', function(e) {
            const colorPickerGroup = document.getElementById('colorPickerGroup');
            colorPickerGroup.style.display = e.target.checked ? 'flex' : 'none';
        });

        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            // Show selected page
            if (pageName === 'editor') {
                document.getElementById('editorPage').classList.add('active');
                document.querySelector('[onclick="showPage(\'editor\')"]').classList.add('active');
            } else if (pageName === 'about') {
                document.getElementById('aboutPage').classList.add('active');
                document.querySelector('[onclick="showPage(\'about\')"]').classList.add('active');
            } else if (pageName === 'contact') {
                document.getElementById('contactPage').classList.add('active');
                document.querySelector('[onclick="showPage(\'contact\')"]').classList.add('active');
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // Update all text elements
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
                        element.value = t[key];
                    } else {
                        element.textContent = t[key];
                    }
                }
            });

            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        document.getElementById('overlayInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                overlayImage = e.target.files[0];
                document.getElementById('overlayFileName').textContent = overlayImage.name;
            }
        });

        document.getElementById('targetInput').addEventListener('change', function(e) {
            targetImages = Array.from(e.target.files);
            const count = targetImages.length;
            const text = currentLang === 'en' ? 
                `${count} image${count !== 1 ? 's' : ''} selected` :
                `${count} imagem${count !== 1 ? 'ns' : ''} selecionada${count !== 1 ? 's' : ''}`;
            document.getElementById('targetFileName').textContent = text;
        });

        function analyzeBrightness(imageData, x, y, w, h) {
            let totalBrightness = 0;
            let pixelCount = 0;

            for (let py = y; py < y + h; py++) {
                for (let px = x; px < x + w; px++) {
                    const idx = (py * imageData.width + px) * 4;
                    const r = imageData.data[idx];
                    const g = imageData.data[idx + 1];
                    const b = imageData.data[idx + 2];
                    const brightness = (r + g + b) / 3;
                    totalBrightness += brightness;
                    pixelCount++;
                }
            }

            return totalBrightness / pixelCount / 255;
        }

        function adjustOverlayContrast(overlayCanvas, brightness) {
            const ctx = overlayCanvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, overlayCanvas.width, overlayCanvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const alpha = data[i + 3];
                if (alpha > 0) {
                    if (brightness > 0.5) {
                        // Light background - darken
                        const factor = Math.max(0.02, Math.pow(1.0 - brightness, 2.5));
                        data[i] *= factor;
                        data[i + 1] *= factor;
                        data[i + 2] *= factor;
                    } else {
                        // Dark background - lighten
                        const strength = Math.pow(1.0 - brightness, 0.5);
                        data[i] = data[i] + (255 - data[i]) * strength * 0.95;
                        data[i + 1] = data[i + 1] + (255 - data[i + 1]) * strength * 0.95;
                        data[i + 2] = data[i + 2] + (255 - data[i + 2]) * strength * 0.95;
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function recolorOverlay(overlayCanvas, targetColor) {
            const ctx = overlayCanvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, overlayCanvas.width, overlayCanvas.height);
            const data = imageData.data;
            
            const r = parseInt(targetColor.slice(1, 3), 16);
            const g = parseInt(targetColor.slice(3, 5), 16);
            const b = parseInt(targetColor.slice(5, 7), 16);

            for (let i = 0; i < data.length; i += 4) {
                const alpha = data[i + 3];
                if (alpha > 0) {
                    const luminance = (0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]) / 255;
                    data[i] = luminance * r;
                    data[i + 1] = luminance * g;
                    data[i + 2] = luminance * b;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        async function processImages() {
            if (!overlayImage || targetImages.length === 0) {
                alert(translations[currentLang].error + 
                    (currentLang === 'en' ? 'Please select both overlay and target images' : 
                     'Por favor, selecione as imagens de sobreposição e alvo'));
                return;
            }

            const position = document.getElementById('position').value;
            const heightInput = document.getElementById('height').value;
            const opacity = parseFloat(document.getElementById('opacity').value) / 100;
            const enableRecolor = document.getElementById('enableRecolor').checked;
            const color = document.getElementById('color').value;
            const autoAdjust = document.getElementById('autoAdjust').checked;

            document.getElementById('processBtn').disabled = true;
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('previewGrid').innerHTML = '';

            const overlay = await loadImage(overlayImage);
            const total = targetImages.length;

            for (let i = 0; i < total; i++) {
                const targetFile = targetImages[i];
                updateProgress((i / total) * 100, translations[currentLang].processing + targetFile.name);

                try {
                    const result = await processImage(overlay, targetFile, position, heightInput, 
                                                     opacity, enableRecolor, color, autoAdjust);
                    addPreview(result, targetFile.name);
                } catch (error) {
                    console.error('Error processing image:', error);
                }
            }

            updateProgress(100, translations[currentLang].done);
            document.getElementById('processBtn').disabled = false;
        }

        async function processImage(overlay, targetFile, position, heightInput, opacity, enableRecolor, color, autoAdjust) {
            const base = await loadImage(targetFile);
            
            const canvas = document.createElement('canvas');
            canvas.width = base.width;
            canvas.height = base.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(base, 0, 0);

            // Calculate overlay size
            let newHeight, newWidth;
            if (heightInput) {
                if (heightInput.includes('%')) {
                    const percent = parseFloat(heightInput) / 100;
                    newHeight = Math.floor(base.height * percent);
                } else {
                    newHeight = parseInt(heightInput);
                }
                const aspectRatio = overlay.width / overlay.height;
                newWidth = Math.floor(newHeight * aspectRatio);
            } else {
                const targetArea = base.width * base.height * 0.03;
                const aspectRatio = overlay.width / overlay.height;
                newHeight = Math.floor(Math.sqrt(targetArea / aspectRatio));
                newWidth = Math.floor(newHeight * aspectRatio);
            }

            // Calculate position
            let x, y;
            switch (position) {
                case 'top_left':
                    x = 0; y = 0;
                    break;
                case 'top_right':
                    x = base.width - newWidth; y = 0;
                    break;
                case 'bottom_left':
                    x = 0; y = base.height - newHeight;
                    break;
                default: // bottom_right
                    x = base.width - newWidth; y = base.height - newHeight;
            }

            // Create overlay canvas
            const overlayCanvas = document.createElement('canvas');
            overlayCanvas.width = newWidth;
            overlayCanvas.height = newHeight;
            const overlayCtx = overlayCanvas.getContext('2d');
            overlayCtx.drawImage(overlay, 0, 0, newWidth, newHeight);

            // Apply recolor if enabled
            if (enableRecolor) {
                recolorOverlay(overlayCanvas, color);
            }

            // Apply auto-adjust if enabled
            if (autoAdjust) {
                const baseImageData = ctx.getImageData(x, y, newWidth, newHeight);
                const brightness = analyzeBrightness(baseImageData, 0, 0, newWidth, newHeight);
                adjustOverlayContrast(overlayCanvas, brightness);
            }

            // Apply opacity
            if (opacity < 1.0) {
                overlayCtx.globalAlpha = opacity;
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = newWidth;
                tempCanvas.height = newHeight;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(overlayCanvas, 0, 0);
                overlayCtx.clearRect(0, 0, newWidth, newHeight);
                overlayCtx.globalAlpha = opacity;
                overlayCtx.drawImage(tempCanvas, 0, 0);
            }

            // Composite
            ctx.drawImage(overlayCanvas, x, y);

            return canvas.toDataURL('image/png');
        }

        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        function updateProgress(percent, status) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressFill').textContent = Math.round(percent) + '%';
            document.getElementById('statusText').textContent = status;
        }

        function addPreview(dataUrl, filename) {
            const grid = document.getElementById('previewGrid');
            const item = document.createElement('div');
            item.className = 'preview-item';
            
            const img = document.createElement('img');
            img.src = dataUrl;
            
            const btn = document.createElement('button');
            btn.className = 'download-btn';
            btn.textContent = '⬇️';
            btn.onclick = () => downloadImage(dataUrl, filename);
            
            item.appendChild(img);
            item.appendChild(btn);
            grid.appendChild(item);
        }

        function downloadImage(dataUrl, filename) {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = 'watermarked_' + filename;
            a.click();
        }
    </script>
</body>
</html>